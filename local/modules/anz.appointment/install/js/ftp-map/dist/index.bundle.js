this.BX=this.BX||{},this.BX.Anz=this.BX.Anz||{},function(t,e,n,a){"use strict";var i={controller:"anz:appointment.oneCController",options:n.Extension.getSettings("anz.appointment.ftp-map"),ftpMapSaveBtnId:"ftp-map-save-btn",ftpMapFormId:"ftp-map-form-".concat(Math.round(1e4*Math.random())),getClinicsBtnId:"ftp-map-get-clinics-btn",createdHandleInputRows:0,init:function(t){var e=this;this.optionInput=BX(t),this.valueNode=BX("".concat(t,"_block")),this.changeBtn=BX("ftp-map-change-btn"),this.changeBtn&&this.changeBtn.addEventListener("click",(function(){e.showFtpMapPopup()}))},getClinics:function(){var t=this;this.getClinicsBtn=BX(this.getClinicsBtnId),this.getClinicsBtn&&this.getClinicsBtn.classList.add("ui-btn-wait"),BX.ajax.runAction("".concat(this.controller,".getClinics"),{data:this.createFormData()}).then((function(e){if("success"!==e.status)throw new Error("Something went wrong. Unknown response status - ".response.status);t.renderInputsFromOneCData(e.data)})).catch((function(e){console.log(e),t.getClinicsBtn&&t.getClinicsBtn.classList.remove("ui-btn-wait")}))},createFormData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=new FormData;for(var n in t)e.set(n,t[n]);return e.set("sessid",BX.bitrix_sessid()),e.set(this.options.ignoreFtpOptionKey,"Y"),e},showFtpMapPopup:function(){var t=this;this.ftpMapForm=this.createFtpMapForm(),this.ftpMapPopup=a.PopupManager.create("ftp-map-popup",null,{content:this.ftpMapForm,width:700,closeIcon:!0,titleBar:"",closeByEsc:!0,overlay:{backgroundColor:"black",opacity:500},buttons:[new BX.PopupWindowButton({text:BX.message("SAVE_TEXT"),className:"ui-btn ui-btn-primary",id:this.ftpMapSaveBtnId,events:{click:function(){t.saveFtpMapValue(),t.ftpMapPopup.close()}}})]}),this.ftpMapPopup.show()},createFtpMapForm:function(){var t=this;return BX.create("form",{props:{id:this.ftpMapFormId,classList:"ftp-map-changing-form"},children:[BX.create("table",{children:[BX.create("tbody",{children:[BX.create("tr",{props:{classList:"btn-row"},children:[BX.create("td",{children:[BX.create("button",{props:{classList:"ui-btn ui-btn-success",type:"button"},text:BX.message("HANDLE_INPUT"),events:{click:function(e){var n=e.target.closest("tbody"),a=e.target.closest("tr");a&&n&&(n.append(t.createHandleInputRow()),a.innerHTML="",a.append(t.createHandleInputMoreBtn(n)))}}})]}),BX.create("td",{children:[BX.create("button",{props:{classList:"ui-btn ui-btn-success",id:this.getClinicsBtnId,type:"button"},text:BX.message("LOAD_FROM_1C"),events:{click:function(){return t.getClinics()}}})]})]})]})]})]})},saveFtpMapValue:function(){if(this.ftpMapForm){var t=new FormData(this.ftpMapForm),e={},n=null,a=0;t.forEach((function(t,i){if(0===i.indexOf("guid_"))a=i.split("_")[1],e[n=t]=null;else if(0===i.indexOf("path_")){i.split("_")[1]===a&&(e[n]=t)}})),this.renderOptionValue(e),this.optionInput&&(this.optionInput.value=JSON.stringify(e))}},renderOptionValue:function(t){if(BX.type.isDomNode(this.valueNode)){var e=this.valueNode.querySelectorAll(".table-value-row");e.length&&e.forEach((function(t){t.remove()}));var n=this.valueNode.querySelector("tbody");if(n)for(var a in t)n.prepend(BX.create("tr",{props:{classList:"table-value-row"},children:[BX.create("td",{text:a}),BX.create("td",{text:t[a]})]}))}},createHandleInputRow:function(){return this.createdHandleInputRows>=30?"":(this.createdHandleInputRows++,BX.create("tr",{children:[BX.create("td",{children:[BX.create("input",{attrs:{type:"text",name:"guid_".concat(this.createdHandleInputRows),placeholder:BX.message("GUID_HINT")}})]}),BX.create("td",{children:[BX.create("input",{attrs:{type:"text",name:"path_".concat(this.createdHandleInputRows),placeholder:BX.message("PATH_HINT")}})]})]}))},createHandleInputMoreBtn:function(t){var e=this;return BX.create("td",{attrs:{colspan:"2"},children:[BX.create("button",{props:{classList:"ui-btn ui-btn-success-dark",type:"button"},text:BX.message("ADD_TEXT"),events:{click:function(){return t&&t.append(e.createHandleInputRow())}}})]})},renderInputsFromOneCData:function(t){if("object"===babelHelpers.typeof(t)&&this.getClinicsBtn){var e=this.getClinicsBtn.closest("tbody"),n=this.getClinicsBtn.closest("tr");if(n&&e){n.innerHTML="";var a=0;for(var i in t)a++,e.append(this.createImportedInputRow(t[i],a))}}},createImportedInputRow:function(t,e){return BX.create("tr",{children:[BX.create("td",{children:[BX.create("div",{props:{className:"ftp-map-changing-form-table-clinic-name"},text:t.name}),BX.create("input",{attrs:{type:"text",name:"guid_".concat(e),readonly:!0,value:t.uid}})]}),BX.create("td",{children:[BX.create("input",{attrs:{type:"text",name:"path_".concat(e),placeholder:BX.message("PATH_HINT")}})]})]})}};t.FtpMap=i}(this.BX.Anz.Appointment=this.BX.Anz.Appointment||{},BX.UI,BX,BX.Main);
//# sourceMappingURL=index.bundle.js.map
